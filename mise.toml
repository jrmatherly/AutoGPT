# AutoGPT Platform - Mise Configuration
# https://mise.jdx.dev/

min_version = "2026.1.0"

[settings]
# Trust this project automatically for contributors
paranoid = false
# Enable experimental features for MCP integration
experimental = true
# Use lockfile for reproducible builds
lockfile = true
# Auto-install tools when entering directory
auto_install = true

[env]
# Project identification
AUTOGPT_ROOT = "{{config_root}}"

[tools]
# Core runtime versions - these MUST match production
python = "3.13"
node = "22"

# Package managers
pnpm = "10.28.2"

[tasks]
# Delegate all tasks to autogpt_platform mise tasks
# This allows running mise commands from project root

[tasks.format]
description = "Format and lint all code"
dir = "{{config_root}}/autogpt_platform"
run = "mise run format"

[tasks.test]
description = "Run all tests"
dir = "{{config_root}}/autogpt_platform"
run = "mise run test"

[tasks."test:backend"]
description = "Run backend tests"
dir = "{{config_root}}/autogpt_platform"
run = "mise run test:backend"

[tasks."test:frontend"]
description = "Run frontend E2E tests"
dir = "{{config_root}}/autogpt_platform"
run = "mise run test:frontend"

[tasks.backend]
description = "Run the backend FastAPI server"
alias = "be"
dir = "{{config_root}}/autogpt_platform"
run = "mise run backend"

[tasks.frontend]
description = "Run the frontend Next.js development server"
alias = "fe"
dir = "{{config_root}}/autogpt_platform"
run = "mise run frontend"

[tasks."docker:up"]
description = "Start core services (Supabase, Redis, RabbitMQ, ClamAV)"
alias = "up"
dir = "{{config_root}}/autogpt_platform"
run = "mise run docker:up"

[tasks."docker:down"]
description = "Stop all Docker services"
alias = "down"
dir = "{{config_root}}/autogpt_platform"
run = "mise run docker:down"

[tasks."db:migrate"]
description = "Run database migrations"
dir = "{{config_root}}/autogpt_platform"
run = "mise run db:migrate"

[tasks.install]
description = "Install all dependencies"
dir = "{{config_root}}/autogpt_platform"
run = "mise run install"

[tasks.doctor]
description = "Verify mise environment is correctly configured"
dir = "{{config_root}}/autogpt_platform"
run = "mise run doctor"

# Drift analysis tasks
[tasks."drift:status"]
description = "Show drift status for all projects"
dir = "{{config_root}}/autogpt_platform"
run = "mise run drift:status"

[tasks."drift:scan"]
description = "Scan all projects for patterns"
dir = "{{config_root}}/autogpt_platform"
run = "mise run drift:scan"

[tasks."drift:check"]
description = "Check for violations (CI-friendly)"
dir = "{{config_root}}/autogpt_platform"
run = "mise run drift:check"

[tasks."drift:full"]
description = "Full drift setup: scan, approve, callgraph, and deep analysis"
dir = "{{config_root}}/autogpt_platform"
run = "mise run drift:full"

# Dependency management tasks
[tasks."deps:check"]
description = "Check for outdated dependencies across all projects"
dir = "{{config_root}}/autogpt_platform"
run = "mise run deps:check"

[tasks."deps:update"]
description = "Update dependencies across all projects (safe, respects semver)"
dir = "{{config_root}}/autogpt_platform"
run = "mise run deps:update"

# Release automation tasks
[tasks.release]
description = "Create a new release (interactive)"
run = "{{config_root}}/scripts/release.sh"
raw = true

[tasks."release:major"]
description = "Create a major release (vX.0.0)"
run = "{{config_root}}/scripts/release.sh major --yes"
raw = true

[tasks."release:minor"]
description = "Create a minor release (vX.Y.0)"
run = "{{config_root}}/scripts/release.sh minor --yes"
raw = true

[tasks."release:patch"]
description = "Create a patch release (vX.Y.Z)"
run = "{{config_root}}/scripts/release.sh patch --yes"
raw = true